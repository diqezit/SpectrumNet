<Window
    x:Class="SpectrumNet.ControlPanelWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
    Title="Control Panel"
    Height="440" Width="720"
    MinHeight="440" MinWidth="720"
    WindowStartupLocation="CenterOwner"
    Background="Transparent"
    AllowsTransparency="True"
    WindowStyle="None"
    ResizeMode="NoResize">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <Geometry x:Key="IconPlay">M9,7 L9,17 L18,12 Z</Geometry>
        <Geometry x:Key="IconStop">M8,8 H16 V16 H8 Z</Geometry>

        <Geometry x:Key="IconOverlay">
            M6.5,7.5 H17.5 V16.5 H6.5 Z
            M8.75,9.75 H15.25 V14.25 H8.75 Z
        </Geometry>

        <Geometry x:Key="IconSettings">
            M12,8.1 A3.9,3.9 0 1 1 12,15.9 A3.9,3.9 0 0 1 12,8.1
            M12,2.8 L12,5
            M12,19 L12,21.2
            M2.8,12 L5,12
            M19,12 L21.2,12
            M5.15,5.15 L6.75,6.75
            M17.25,17.25 L18.85,18.85
            M5.15,18.85 L6.75,17.25
            M17.25,6.75 L18.85,5.15
        </Geometry>

        <Geometry x:Key="IconGain">
            M6,19.2 V14
            M6,14 A2.6,2.6 0 1 1 6,8.8 A2.6,2.6 0 0 1 6,14
            M12,19.2 V16
            M12,16 A2.6,2.6 0 1 1 12,10.8 A2.6,2.6 0 0 1 12,16
            M18,19.2 V13
            M18,13 A2.6,2.6 0 1 1 18,7.8 A2.6,2.6 0 0 1 18,13
        </Geometry>

        <Geometry x:Key="IconRender">
            M6,18 H18
            M7.5,18 V12
            M11,18 V9
            M14.5,18 V13.5
            M18,6 H6
        </Geometry>

        <Geometry x:Key="IconAudio">
            M6,16 V12
            M9.5,18 V10
            M13,16 V8
            M16.5,14 V6
        </Geometry>

        <Geometry x:Key="IconApp">
            M7,5 H17 A2,2 0 0 1 19,7 V17 A2,2 0 0 1 17,19 H7 A2,2 0 0 1 5,17 V7 A2,2 0 0 1 7,5 Z
            M7.5,8.3 H16.5
            M8.8,11.4 H15.2
            M8.8,14.3 H15.2
            M8.8,17 H12.7
        </Geometry>

        <Geometry x:Key="IconClose">M7,7 L17,17 M17,7 L7,17</Geometry>

        <Geometry x:Key="IconMinDb">
            M6,12 L12,18 L18,12
            M12,18 V6
        </Geometry>

        <Geometry x:Key="IconMaxDb">
            M6,12 L12,6 L18,12
            M12,6 V18
        </Geometry>

        <Geometry x:Key="IconAmp">
            M6,16 V12
            M9.5,18 V10
            M13,16 V8
            M16.5,14 V6
        </Geometry>

        <Geometry x:Key="IconOverlayTop">
            M7,7 H17 V19 H7 Z
            M7,7 V5 H17 V7
            M12,10 V16
            M10.6,11.4 L12,10 L13.4,11.4
        </Geometry>

        <Geometry x:Key="IconFps">
            M12,6 A7,7 0 1 1 12,20 A7,7 0 0 1 12,6
            M12,12 L16.8,10.1
        </Geometry>

        <Geometry x:Key="IconClock">
            M12,6 A7,7 0 1 1 12,20 A7,7 0 0 1 12,6
            M12,9 V12.3 L14.8,13.8
        </Geometry>
    </Window.Resources>

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome
            CaptionHeight="0"
            CornerRadius="0"
            GlassFrameThickness="0"
            ResizeBorderThickness="0"/>
    </shell:WindowChrome.WindowChrome>

    <Border
        Background="{DynamicResource WindowBackgroundBrush}"
        BorderBrush="{DynamicResource WindowBorderBrush}"
        BorderThickness="1"
        CornerRadius="14">

        <Grid KeyboardNavigation.TabNavigation="Cycle">
            <Grid.RowDefinitions>
                <RowDefinition Height="52"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border
                x:Name="TitleBar"
                Grid.Row="0"
                Style="{DynamicResource TitleBarBorderStyle}"
                CornerRadius="14,14,0,0"
                MouseLeftButtonDown="OnTitleBarMouseLeftButtonDown">

                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">

                        <Border Width="36" Height="36"
                                CornerRadius="8"
                                Background="{DynamicResource WindowControlHoverBrush}"
                                Opacity="0.6"
                                Margin="0,0,12,0">
                            <Path Width="20" Height="20"
                                  Stroke="{DynamicResource WindowForegroundBrush}"
                                  StrokeThickness="2"
                                  StrokeStartLineCap="Round"
                                  StrokeEndLineCap="Round"
                                  StrokeLineJoin="Round"
                                  Fill="Transparent"
                                  Stretch="Uniform"
                                  Data="{StaticResource IconSettings}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                        </Border>

                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Control Panel"
                                       FontSize="17"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource WindowForegroundBrush}"/>
                            <TextBlock Text="Audio Visualization Settings"
                                       FontSize="11"
                                       Foreground="{DynamicResource WindowForegroundBrush}"
                                       Opacity="0.75"
                                       Margin="0,1,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <Button x:Name="CloseButton"
                            Grid.Column="1"
                            Style="{DynamicResource WindowCloseButtonStyle}"
                            Width="36" Height="36"
                            Click="OnButtonClick"
                            ToolTip="Close"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            Foreground="{DynamicResource WindowForegroundBrush}">
                        <Path Width="12" Height="12"
                              Data="{StaticResource IconClose}"
                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              StrokeThickness="2.2"
                              StrokeStartLineCap="Round"
                              StrokeEndLineCap="Round"
                              StrokeLineJoin="Round"
                              Fill="Transparent"
                              Stretch="Uniform"/>
                    </Button>
                </Grid>
            </Border>

            <Border Grid.Row="1"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="0,0,14,14"
                    Padding="16">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="12"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0"
                            Background="{DynamicResource ControlsPanelBackgroundBrush}"
                            CornerRadius="12"
                            Padding="12">

                        <UniformGrid Columns="5" Rows="1">
                            <Button x:Name="StartCaptureButton"
                                    Style="{DynamicResource AccentButtonStyle}"
                                    Height="44"
                                    Margin="6,0"
                                    IsEnabled="{Binding CanStartCapture}"
                                    Click="OnButtonClick"
                                    ToolTip="Start audio capture">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0"
                                            Width="28" Height="28"
                                            CornerRadius="6"
                                            Background="{DynamicResource ButtonHoverBackgroundBrush}"
                                            Opacity="0.35"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                        <Path Width="14" Height="14"
                                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                              Stretch="Uniform"
                                              Data="{StaticResource IconPlay}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="Start"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Button>

                            <Button x:Name="StopCaptureButton"
                                    Style="{DynamicResource DangerButtonStyle}"
                                    Height="44"
                                    Margin="6,0"
                                    IsEnabled="{Binding IsRecording}"
                                    Click="OnButtonClick"
                                    ToolTip="Stop audio capture">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0"
                                            Width="28" Height="28"
                                            CornerRadius="6"
                                            Background="{DynamicResource ButtonHoverBackgroundBrush}"
                                            Opacity="0.35"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                        <Path Width="12" Height="12"
                                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                              Stretch="Uniform"
                                              Data="{StaticResource IconStop}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="Stop"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Button>

                            <Button x:Name="OverlayButton"
                                    Style="{DynamicResource ModernButtonStyle}"
                                    Height="44"
                                    Margin="6,0"
                                    Click="OnButtonClick"
                                    ToolTip="Toggle visualization overlay">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0"
                                            Width="28" Height="28"
                                            CornerRadius="6"
                                            Background="{DynamicResource HoverBackgroundBrush}"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                        <Path Width="16" Height="16"
                                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                              StrokeThickness="2"
                                              StrokeStartLineCap="Round"
                                              StrokeEndLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Fill="Transparent"
                                              Stretch="Uniform"
                                              Data="{StaticResource IconOverlay}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="Overlay"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Button>

                            <Button x:Name="OpenSettingsButton"
                                    Style="{DynamicResource ModernButtonStyle}"
                                    Height="44"
                                    Margin="6,0"
                                    Click="OnButtonClick"
                                    ToolTip="Open application settings">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0"
                                            Width="28" Height="28"
                                            CornerRadius="6"
                                            Background="{DynamicResource HoverBackgroundBrush}"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                        <Path Width="16" Height="16"
                                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                              StrokeThickness="2"
                                              StrokeStartLineCap="Round"
                                              StrokeEndLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Fill="Transparent"
                                              Stretch="Uniform"
                                              Data="{StaticResource IconSettings}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="Settings"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Button>

                            <Button x:Name="OpenPopupButton"
                                    Style="{DynamicResource ModernButtonStyle}"
                                    Height="44"
                                    Margin="6,0"
                                    Click="OnButtonClick"
                                    ToolTip="Open audio gain controls">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0"
                                            Width="28" Height="28"
                                            CornerRadius="6"
                                            Background="{DynamicResource HoverBackgroundBrush}"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center">
                                        <Path Width="16" Height="16"
                                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                              StrokeThickness="2"
                                              StrokeStartLineCap="Round"
                                              StrokeEndLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Fill="Transparent"
                                              Stretch="Uniform"
                                              Data="{StaticResource IconGain}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Grid.Column="1"
                                               Text="Gain"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Button>
                        </UniformGrid>
                    </Border>

                    <ScrollViewer Grid.Row="2"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  CanContentScroll="True">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- RENDERING -->
                            <Border Grid.Column="0"
                                    Background="{DynamicResource ControlsPanelBackgroundBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    MinWidth="200">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0"
                                            Background="{DynamicResource BackgroundBrush}"
                                            CornerRadius="12,12,0,0"
                                            Padding="14,12">
                                        <StackPanel Orientation="Horizontal">
                                            <Border Width="32" Height="32"
                                                    CornerRadius="8"
                                                    Background="{DynamicResource AccentBrush}"
                                                    Margin="0,0,12,0">
                                                <Path Width="16" Height="16"
                                                      Stroke="{DynamicResource SliderThumbAccentBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      StrokeLineJoin="Round"
                                                      Fill="Transparent"
                                                      Stretch="Uniform"
                                                      Data="{StaticResource IconRender}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="Rendering"
                                                           FontSize="15"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                <TextBlock Text="Visual settings"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <StackPanel Grid.Row="1" Margin="14">

                                        <TextBlock Text="Renderer"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,0,0,8"/>

                                        <ComboBox x:Name="RenderStyleComboBox"
                                                  Style="{DynamicResource ModernComboBoxStyle}"
                                                  Height="36"
                                                  Margin="0,0,0,14"
                                                  ItemsSource="{Binding View.OrderedDrawingTypes}"
                                                  SelectedItem="{Binding View.SelectedDrawingType, Mode=TwoWay}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <Button Grid.Column="0"
                                                                Tag="{Binding}"
                                                                Style="{DynamicResource FavoriteButtonStyle}"
                                                                Click="OnFavoriteButtonClick"
                                                                VerticalAlignment="Center"/>

                                                        <Viewbox Grid.Column="1"
                                                                 Stretch="Uniform"
                                                                 StretchDirection="DownOnly"
                                                                 HorizontalAlignment="Stretch"
                                                                 VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding}"
                                                                       Margin="8,0,0,0"
                                                                       VerticalAlignment="Center"
                                                                       TextWrapping="NoWrap"
                                                                       TextTrimming="None"
                                                                       TextAlignment="Left"/>
                                                        </Viewbox>
                                                    </Grid>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <TextBlock Text="Paint"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,0,0,8"/>

                                        <ComboBox Style="{DynamicResource ModernComboBoxStyle}"
                                                  Height="36"
                                                  Margin="0,0,0,14"
                                                  ItemsSource="{Binding View.AvailablePalettes.Keys}"
                                                  SelectedItem="{Binding View.SelectedStyle, Mode=TwoWay}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid VerticalAlignment="Center">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <Border Grid.Column="0"
                                                                Width="16" Height="16"
                                                                Margin="0,0,10,0"
                                                                CornerRadius="4"
                                                                BorderBrush="{DynamicResource BorderBrush}"
                                                                BorderThickness="1"
                                                                Background="{Binding Converter={StaticResource PaletteNameToBrushConverter}}"/>

                                                        <Viewbox Grid.Column="1"
                                                                 Stretch="Uniform"
                                                                 StretchDirection="DownOnly"
                                                                 HorizontalAlignment="Stretch"
                                                                 VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding}"
                                                                       VerticalAlignment="Center"
                                                                       TextWrapping="NoWrap"
                                                                       TextTrimming="None"
                                                                       TextAlignment="Left"/>
                                                        </Viewbox>
                                                    </Grid>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="Interval"
                                                       FontSize="12"
                                                       FontWeight="Medium"
                                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            <Border Grid.Column="1"
                                                    Background="{DynamicResource AccentBrush}"
                                                    CornerRadius="4"
                                                    Padding="8,3">
                                                <TextBlock Text="{Binding View.BarSpacing, StringFormat='{}{0:F0}'}"
                                                           FontSize="11"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource SliderThumbAccentBrush}"/>
                                            </Border>
                                        </Grid>
                                        <Slider Style="{DynamicResource ModernSliderStyle}"
                                                Height="24"
                                                Margin="0,0,0,14"
                                                Minimum="1" Maximum="15"
                                                Value="{Binding View.BarSpacing, Mode=TwoWay}"/>

                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="Strips"
                                                       FontSize="12"
                                                       FontWeight="Medium"
                                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                                       ToolTip="Number of visualization strips"/>
                                            <Border Grid.Column="1"
                                                    Background="{DynamicResource AccentBrush}"
                                                    CornerRadius="4"
                                                    Padding="8,3">
                                                <TextBlock Text="{Binding View.BarCount, StringFormat='{}{0:F0}'}"
                                                           FontSize="11"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource SliderThumbAccentBrush}"/>
                                            </Border>
                                        </Grid>
                                        <Slider Style="{DynamicResource ModernSliderStyle}"
                                                Height="24"
                                                Margin="0,0,0,14"
                                                Minimum="10" Maximum="500"
                                                Value="{Binding View.BarCount, Mode=TwoWay}"/>

                                        <TextBlock Text="Quality"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,0,0,8"
                                                   ToolTip="Render quality setting"/>

                                        <ComboBox Style="{DynamicResource ModernComboBoxStyle}"
                                                  Height="36"
                                                  ItemsSource="{Binding View.AvailableRenderQualities}"
                                                  SelectedItem="{Binding View.RenderQuality, Mode=TwoWay}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- AUDIO -->
                            <Border Grid.Column="2"
                                    Background="{DynamicResource ControlsPanelBackgroundBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    MinWidth="200">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0"
                                            Background="{DynamicResource BackgroundBrush}"
                                            CornerRadius="12,12,0,0"
                                            Padding="14,12">
                                        <StackPanel Orientation="Horizontal">
                                            <Border Width="32" Height="32"
                                                    CornerRadius="8"
                                                    Background="{DynamicResource AccentBrush}"
                                                    Margin="0,0,12,0">
                                                <Path Width="16" Height="16"
                                                      Stroke="{DynamicResource SliderThumbAccentBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      StrokeLineJoin="Round"
                                                      Fill="Transparent"
                                                      Stretch="Uniform"
                                                      Data="{StaticResource IconAudio}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="Audio"
                                                           FontSize="15"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                <TextBlock Text="Processing settings"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <StackPanel Grid.Row="1" Margin="14">
                                        <TextBlock Text="Window FFT"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,0,0,8"
                                                   ToolTip="FFT window function type"/>
                                        <ComboBox Style="{DynamicResource ModernComboBoxStyle}"
                                                  Height="36"
                                                  Margin="0,0,0,14"
                                                  ItemsSource="{Binding View.AvailableFftWindowTypes}"
                                                  SelectedItem="{Binding WindowType, Mode=TwoWay}"/>

                                        <TextBlock Text="Scale Type"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,0,0,8"
                                                   ToolTip="Frequency scale type"/>
                                        <ComboBox Style="{DynamicResource ModernComboBoxStyle}"
                                                  Height="36"
                                                  Margin="0,0,0,14"
                                                  ItemsSource="{Binding View.AvailableScaleTypes}"
                                                  SelectedItem="{Binding ScaleType, Mode=TwoWay}"/>

                                        <TextBlock Text="Stereo Mode"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,0,0,8"
                                                   ToolTip="Audio channel processing mode"/>
                                        <ComboBox Style="{DynamicResource ModernComboBoxStyle}"
                                                  Height="36"
                                                  ItemsSource="{Binding View.AvailableStereoModes}"
                                                  SelectedItem="{Binding Audio.StereoMode, Mode=TwoWay}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- APPLICATION -->
                            <Border Grid.Column="4"
                                    Background="{DynamicResource ControlsPanelBackgroundBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    MinWidth="200">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0"
                                            Background="{DynamicResource BackgroundBrush}"
                                            CornerRadius="12,12,0,0"
                                            Padding="14,12">
                                        <StackPanel Orientation="Horizontal">
                                            <Border Width="32" Height="32"
                                                    CornerRadius="8"
                                                    Background="{DynamicResource AccentBrush}"
                                                    Margin="0,0,12,0">
                                                <Path Width="16" Height="16"
                                                      Stroke="{DynamicResource SliderThumbAccentBrush}"
                                                      StrokeThickness="2"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      StrokeLineJoin="Round"
                                                      Fill="Transparent"
                                                      Stretch="Uniform"
                                                      Data="{StaticResource IconApp}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="Application"
                                                           FontSize="15"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                <TextBlock Text="General settings"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <StackPanel Grid.Row="1" Margin="14">

                                        <Border Background="{DynamicResource BackgroundBrush}"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="10"
                                                Padding="12"
                                                Margin="0,0,0,10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0"
                                                        Width="36" Height="36"
                                                        CornerRadius="8"
                                                        Background="{DynamicResource HoverBackgroundBrush}"
                                                        Margin="0,0,12,0">
                                                    <Path Width="20" Height="20"
                                                          Stroke="{DynamicResource TextSecondaryBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"
                                                          StrokeLineJoin="Round"
                                                          Fill="Transparent"
                                                          Stretch="Uniform"
                                                          Data="{StaticResource IconOverlayTop}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="Overlay: Topmost"
                                                               FontWeight="Medium"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                                               TextWrapping="Wrap"/>
                                                    <TextBlock Text="Keep overlay always on top"
                                                               FontSize="11"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               Margin="0,2,0,0"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>

                                                <CheckBox Grid.Column="2"
                                                          Style="{DynamicResource ModernCheckBoxStyle}"
                                                          IsChecked="{Binding UI.IsOverlayTopmost, Mode=TwoWay}"
                                                          VerticalAlignment="Center"
                                                          ToolTip="Keep the overlay always on top"/>
                                            </Grid>
                                        </Border>

                                        <Border Background="{DynamicResource BackgroundBrush}"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="10"
                                                Padding="12"
                                                Margin="0,0,0,10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0"
                                                        Width="36" Height="36"
                                                        CornerRadius="8"
                                                        Background="{DynamicResource HoverBackgroundBrush}"
                                                        Margin="0,0,12,0">
                                                    <Path Width="20" Height="20"
                                                          Stroke="{DynamicResource TextSecondaryBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"
                                                          StrokeLineJoin="Round"
                                                          Fill="Transparent"
                                                          Stretch="Uniform"
                                                          Data="{StaticResource IconFps}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="FPS: Show counter"
                                                               FontWeight="Medium"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                                               TextWrapping="Wrap"/>
                                                    <TextBlock Text="Display FPS counter"
                                                               FontSize="11"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               Margin="0,2,0,0"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>

                                                <CheckBox Grid.Column="2"
                                                          Style="{DynamicResource ModernCheckBoxStyle}"
                                                          IsChecked="{Binding View.ShowPerformanceInfo, Mode=TwoWay}"
                                                          VerticalAlignment="Center"
                                                          ToolTip="Display FPS counter"/>
                                            </Grid>
                                        </Border>

                                        <Border Background="{DynamicResource BackgroundBrush}"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="10"
                                                Padding="12">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0"
                                                        Width="36" Height="36"
                                                        CornerRadius="8"
                                                        Background="{DynamicResource HoverBackgroundBrush}"
                                                        Margin="0,0,12,0">
                                                    <Path Width="20" Height="20"
                                                          Stroke="{DynamicResource TextSecondaryBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"
                                                          StrokeLineJoin="Round"
                                                          Fill="Transparent"
                                                          Stretch="Uniform"
                                                          Data="{StaticResource IconClock}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="Limit FPS: 60"
                                                               FontWeight="Medium"
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                                               TextWrapping="Wrap"/>
                                                    <TextBlock Text="Window mode only"
                                                               FontSize="11"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               Margin="0,2,0,0"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>

                                                <CheckBox Grid.Column="2"
                                                          Style="{DynamicResource ModernCheckBoxStyle}"
                                                          IsChecked="{Binding LimitFpsTo60, Mode=TwoWay}"
                                                          VerticalAlignment="Center"
                                                          ToolTip="Limit to 60 FPS (Window Mode only)"/>
                                            </Grid>
                                        </Border>

                                    </StackPanel>
                                </Grid>
                            </Border>

                        </Grid>
                    </ScrollViewer>
                </Grid>
            </Border>

            <Grid Grid.RowSpan="2"
                  Panel.ZIndex="100"
                  Visibility="{Binding UI.IsPopupOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
                  MouseDown="OnOverlayMouseDown">

                <Border Background="{DynamicResource OverlayBackgroundBrush}"/>

                <Border HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Background="{DynamicResource SurfaceBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="16"
                        Width="420"
                        MaxHeight="380"
                        MouseDown="OnPopupMouseDown">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0"
                                Background="{DynamicResource ControlsPanelBackgroundBrush}"
                                CornerRadius="16,16,0,0"
                                Padding="18,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <Border Width="40" Height="40"
                                            CornerRadius="10"
                                            Background="{DynamicResource AccentBrush}"
                                            Margin="0,0,14,0">
                                        <Path Width="20" Height="20"
                                              Stroke="{DynamicResource SliderThumbAccentBrush}"
                                              StrokeThickness="2.2"
                                              StrokeStartLineCap="Round"
                                              StrokeEndLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Fill="Transparent"
                                              Stretch="Uniform"
                                              Data="{StaticResource IconGain}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                    </Border>

                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Gain Settings"
                                                   FontSize="18"
                                                   FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                                        <TextBlock Text="Adjust audio levels"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>
                                </StackPanel>

                                <Button Grid.Column="1"
                                        HorizontalAlignment="Right"
                                        Style="{DynamicResource WindowCloseButtonStyle}"
                                        Width="34" Height="34"
                                        Click="OnClosePopup"
                                        Foreground="{DynamicResource TextPrimaryBrush}">
                                    <Path Width="12" Height="12"
                                          Data="{StaticResource IconClose}"
                                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2.2"
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"
                                          StrokeLineJoin="Round"
                                          Fill="Transparent"
                                          Stretch="Uniform"/>
                                </Button>
                            </Grid>
                        </Border>

                        <ScrollViewer Grid.Row="1"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="16">

                            <StackPanel>

                                <Border Background="{DynamicResource BackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="10"
                                        Padding="14"
                                        Margin="0,0,0,10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="10"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                                <Border Width="32" Height="32"
                                                        CornerRadius="8"
                                                        Background="{DynamicResource HoverBackgroundBrush}"
                                                        Margin="0,0,10,0">
                                                    <Path Width="16" Height="16"
                                                          Stroke="{DynamicResource TextSecondaryBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"
                                                          StrokeLineJoin="Round"
                                                          Fill="Transparent"
                                                          Stretch="Uniform"
                                                          Data="{StaticResource IconMinDb}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>
                                                <TextBlock Text="Min dB level"
                                                           FontSize="14"
                                                           FontWeight="Medium"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <Border Grid.Column="1"
                                                    Background="{DynamicResource AccentBrush}"
                                                    CornerRadius="6"
                                                    Padding="10,5"
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Audio.MinDbLevel, StringFormat='{}{0:F0} dB'}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource SliderThumbAccentBrush}"/>
                                            </Border>
                                        </Grid>

                                        <Slider Grid.Row="2"
                                                Style="{DynamicResource ModernSliderStyle}"
                                                Height="26"
                                                Minimum="-200" Maximum="0"
                                                Value="{Binding Audio.MinDbLevel, Mode=TwoWay}"/>
                                    </Grid>
                                </Border>

                                <Border Background="{DynamicResource BackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="10"
                                        Padding="14"
                                        Margin="0,0,0,10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="10"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                                <Border Width="32" Height="32"
                                                        CornerRadius="8"
                                                        Background="{DynamicResource HoverBackgroundBrush}"
                                                        Margin="0,0,10,0">
                                                    <Path Width="16" Height="16"
                                                          Stroke="{DynamicResource TextSecondaryBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"
                                                          StrokeLineJoin="Round"
                                                          Fill="Transparent"
                                                          Stretch="Uniform"
                                                          Data="{StaticResource IconMaxDb}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>
                                                <TextBlock Text="Max dB level"
                                                           FontSize="14"
                                                           FontWeight="Medium"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <Border Grid.Column="1"
                                                    Background="{DynamicResource AccentBrush}"
                                                    CornerRadius="6"
                                                    Padding="10,5"
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Audio.MaxDbLevel, StringFormat='{}{0:F0} dB'}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource SliderThumbAccentBrush}"/>
                                            </Border>
                                        </Grid>

                                        <Slider Grid.Row="2"
                                                Style="{DynamicResource ModernSliderStyle}"
                                                Height="26"
                                                Minimum="-100" Maximum="0"
                                                Value="{Binding Audio.MaxDbLevel, Mode=TwoWay}"/>
                                    </Grid>
                                </Border>

                                <Border Background="{DynamicResource BackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="10"
                                        Padding="14">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="10"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                                <Border Width="32" Height="32"
                                                        CornerRadius="8"
                                                        Background="{DynamicResource HoverBackgroundBrush}"
                                                        Margin="0,0,10,0">
                                                    <Path Width="16" Height="16"
                                                          Stroke="{DynamicResource TextSecondaryBrush}"
                                                          StrokeThickness="2"
                                                          StrokeStartLineCap="Round"
                                                          StrokeEndLineCap="Round"
                                                          StrokeLineJoin="Round"
                                                          Fill="Transparent"
                                                          Stretch="Uniform"
                                                          Data="{StaticResource IconAmp}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                                </Border>
                                                <TextBlock Text="Amplification"
                                                           FontSize="14"
                                                           FontWeight="Medium"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <Border Grid.Column="1"
                                                    Background="{DynamicResource AccentBrush}"
                                                    CornerRadius="6"
                                                    Padding="10,5"
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Audio.AmplificationFactor, StringFormat='{}{0:F2}x'}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource SliderThumbAccentBrush}"/>
                                            </Border>
                                        </Grid>

                                        <Slider Grid.Row="2"
                                                Style="{DynamicResource ModernSliderStyle}"
                                                Height="26"
                                                Minimum="0.01" Maximum="5"
                                                Value="{Binding Audio.AmplificationFactor, Mode=TwoWay}"/>
                                    </Grid>
                                </Border>

                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>

        </Grid>
    </Border>
</Window>
