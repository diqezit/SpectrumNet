<Window x:Class="SpectrumNet.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        Title="Settings"
        Width="450" Height="500"
        MinWidth="450" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        ResizeMode="CanResize"
        PreviewKeyDown="OnWindowKeyDown">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="0"
                            CornerRadius="0"
                            GlassFrameThickness="0"
                            ResizeBorderThickness="6"/>
    </shell:WindowChrome.WindowChrome>

    <Window.Resources>
        <Geometry x:Key="IconSettingsGear">
            M12,8.2 A3.8,3.8 0 1 1 12,15.8 A3.8,3.8 0 0 1 12,8.2
            M12,2.8 L12,4.9
            M12,19.1 L12,21.2
            M2.8,12 L4.9,12
            M19.1,12 L21.2,12
            M5.2,5.2 L6.7,6.7
            M17.3,17.3 L18.8,18.8
            M5.2,18.8 L6.7,17.3
            M17.3,6.7 L18.8,5.2
        </Geometry>

        <Geometry x:Key="IconClose">M7,7 L17,17 M17,7 L7,17</Geometry>

        <Geometry x:Key="IconSliders">
            M6,8 H18
            M6,16 H18
            M9,8 V12
            M15,12 V16
        </Geometry>

        <Geometry x:Key="IconKeyboard">
            M5,8 H19 V16 H5 Z
            M7,10 H9 M10,10 H12 M13,10 H15 M16,10 H17
            M7,12 H9 M10,12 H12 M13,12 H15 M16,12 H17
            M7,14 H17
        </Geometry>

        <Style x:Key="TabHeaderIconStyle" TargetType="Path">
            <Setter Property="Width" Value="16"/>
            <Setter Property="Height" Value="16"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="StrokeThickness" Value="2"/>
            <Setter Property="StrokeStartLineCap" Value="Round"/>
            <Setter Property="StrokeEndLineCap" Value="Round"/>
            <Setter Property="StrokeLineJoin" Value="Round"/>
            <Setter Property="Fill" Value="Transparent"/>
            <Setter Property="Stretch" Value="Uniform"/>
            <Setter Property="Stroke"
                    Value="{Binding Foreground, RelativeSource={RelativeSource AncestorType=TabItem}}"/>
        </Style>

        <Style x:Key="TabHeaderTextStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground"
                    Value="{Binding Foreground, RelativeSource={RelativeSource AncestorType=TabItem}}"/>
        </Style>

        <DataTemplate x:Key="SliderSettingTemplate">
            <Grid Margin="0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding Label}"
                           Style="{DynamicResource SettingsTextBlockStyle}"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           TextWrapping="Wrap"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"/>

                <Grid Grid.Column="1" VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Slider Grid.Column="0"
                            Style="{DynamicResource ModernSliderStyle}"
                            Minimum="{Binding Min}"
                            Maximum="{Binding Max}"
                            Value="{Binding Value, Mode=TwoWay}"
                            Height="22"
                            VerticalAlignment="Center"/>

                    <Border Grid.Column="1"
                            Margin="12,0,0,0"
                            Padding="10,4"
                            VerticalAlignment="Center"
                            CornerRadius="{StaticResource CornerRadiusSmall}"
                            Background="{DynamicResource AccentBrush}">
                        <TextBlock MinWidth="56"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource SliderThumbAccentBrush}"
                                   FontWeight="SemiBold"
                                   Text="{Binding Value, StringFormat={}{0:0.##}}"/>
                    </Border>
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="KeyBindingTemplate">
            <Grid Margin="0,6" MinHeight="36">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Viewbox Grid.Column="0"
                         Margin="0,0,12,0"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Left"
                         Stretch="Uniform"
                         StretchDirection="DownOnly"
                         MaxHeight="18">
                    <TextBlock Text="{Binding ActionName}"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               FontWeight="SemiBold"
                               TextWrapping="NoWrap"
                               TextTrimming="None"/>
                </Viewbox>

                <Border Grid.Column="1"
                        BorderBrush="{Binding BorderBrush}"
                        BorderThickness="{Binding BorderThickness}"
                        CornerRadius="{StaticResource CornerRadiusSmall}"
                        Background="{DynamicResource BackgroundBrush}"
                        Padding="10,6"
                        MinWidth="96"
                        Margin="0,0,12,0"
                        VerticalAlignment="Center">
                    <TextBlock Text="{Binding KeyDisplay}"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontWeight="SemiBold"/>
                </Border>

                <Button Grid.Column="2"
                        Content="{Binding ButtonText}"
                        Command="{Binding ToggleCaptureCommand}"
                        Background="{Binding ButtonBackground}"
                        Style="{DynamicResource ModernButtonStyle}"
                        Height="32"
                        MinWidth="104"
                        FontSize="12"
                        VerticalAlignment="Center"/>
            </Grid>
        </DataTemplate>
    </Window.Resources>

    <Border Background="{DynamicResource WindowBackgroundBrush}"
            BorderBrush="{DynamicResource WindowBorderBrush}"
            BorderThickness="1"
            CornerRadius="{StaticResource CornerRadiusLarge}">

        <Grid KeyboardNavigation.TabNavigation="Cycle">
            <Grid.RowDefinitions>
                <RowDefinition Height="56"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0"
                    Style="{DynamicResource TitleBarBorderStyle}"
                    CornerRadius="12,12,0,0"
                    MouseLeftButtonDown="OnDrag"
                    WindowChrome.IsHitTestVisibleInChrome="True">
                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Border Width="36" Height="36"
                                CornerRadius="{StaticResource CornerRadiusSmall}"
                                Background="{DynamicResource WindowControlHoverBrush}"
                                Opacity="0.6"
                                Margin="0,0,12,0">
                            <Path Width="20" Height="20"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Stroke="{DynamicResource WindowForegroundBrush}"
                                  StrokeThickness="2"
                                  StrokeStartLineCap="Round"
                                  StrokeEndLineCap="Round"
                                  StrokeLineJoin="Round"
                                  Fill="Transparent"
                                  Stretch="Uniform"
                                  Data="{StaticResource IconSettingsGear}"/>
                        </Border>

                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Settings"
                                       Style="{StaticResource SubheaderTextBlockStyle}"
                                       Foreground="{DynamicResource WindowForegroundBrush}"/>
                            <TextBlock Text="Customize visuals and key binds"
                                       FontSize="11"
                                       Foreground="{DynamicResource WindowForegroundBrush}"
                                       Opacity="0.75"
                                       Margin="0,2,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Command="{Binding CloseWindowCommand}"
                            Style="{DynamicResource WindowCloseButtonStyle}"
                            Width="36"
                            Height="36"
                            VerticalAlignment="Center"
                            Foreground="{DynamicResource WindowForegroundBrush}"
                            WindowChrome.IsHitTestVisibleInChrome="True">
                        <Path Width="12" Height="12"
                              Data="{StaticResource IconClose}"
                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              StrokeThickness="2.2"
                              StrokeStartLineCap="Round"
                              StrokeEndLineCap="Round"
                              StrokeLineJoin="Round"
                              Fill="Transparent"
                              Stretch="Uniform"/>
                    </Button>
                </Grid>
            </Border>

            <Border Grid.Row="1"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="{StaticResource CornerRadiusLarge}"
                    Margin="16"
                    Padding="14">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TabControl Grid.Row="0"
                                Style="{DynamicResource ModernTabControlStyle}"
                                Margin="0,0,0,12">

                        <TabItem Style="{DynamicResource ModernTabItemStyle}">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal">
                                    <Path Style="{StaticResource TabHeaderIconStyle}"
                                          Data="{StaticResource IconSliders}"/>
                                    <TextBlock Style="{StaticResource TabHeaderTextStyle}"
                                               Text="Particles"/>
                                </StackPanel>
                            </TabItem.Header>

                            <ScrollViewer Style="{DynamicResource ModernScrollViewerStyle}"
                                          VerticalScrollBarVisibility="Auto"
                                          Padding="14">
                                <ItemsControl ItemsSource="{Binding ParticleSettings}"
                                              ItemTemplate="{StaticResource SliderSettingTemplate}"/>
                            </ScrollViewer>
                        </TabItem>

                        <TabItem Style="{DynamicResource ModernTabItemStyle}">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal">
                                    <Path Style="{StaticResource TabHeaderIconStyle}"
                                          Data="{StaticResource IconSliders}"/>
                                    <TextBlock Style="{StaticResource TabHeaderTextStyle}"
                                               Text="Raindrops"/>
                                </StackPanel>
                            </TabItem.Header>

                            <ScrollViewer Style="{DynamicResource ModernScrollViewerStyle}"
                                          VerticalScrollBarVisibility="Auto"
                                          Padding="14">
                                <ItemsControl ItemsSource="{Binding RaindropSettings}"
                                              ItemTemplate="{StaticResource SliderSettingTemplate}"/>
                            </ScrollViewer>
                        </TabItem>

                        <TabItem Style="{DynamicResource ModernTabItemStyle}">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal">
                                    <Path Style="{StaticResource TabHeaderIconStyle}"
                                          Data="{StaticResource IconKeyboard}"/>
                                    <TextBlock Style="{StaticResource TabHeaderTextStyle}"
                                               Text="Key Bindings"/>
                                </StackPanel>
                            </TabItem.Header>

                            <ScrollViewer Style="{DynamicResource ModernScrollViewerStyle}"
                                          VerticalScrollBarVisibility="Auto"
                                          Padding="14">
                                <ItemsControl ItemsSource="{Binding KeyBindings}"
                                              ItemTemplate="{StaticResource KeyBindingTemplate}"/>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>

                    <Border Grid.Row="1"
                            Background="{DynamicResource ControlsPanelBackgroundBrush}"
                            CornerRadius="{StaticResource CornerRadiusMedium}"
                            Padding="12"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       Text="Changes are applied immediately or on Apply."
                                       TextWrapping="Wrap"
                                       VerticalAlignment="Center"
                                       Margin="0,0,12,0"/>

                            <Button Grid.Column="1"
                                    Content="Reset"
                                    Command="{Binding ResetCommand}"
                                    Style="{DynamicResource ModernButtonStyle}"
                                    Height="36"
                                    MinWidth="120"
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center"/>

                            <Button Grid.Column="2"
                                    Content="Apply"
                                    Command="{Binding ApplyCommand}"
                                    Style="{DynamicResource AccentButtonStyle}"
                                    Height="36"
                                    MinWidth="120"
                                    VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
